<div class="song-details-container" *ngIf="album">
  <!-- Left Side - Album Info -->
  <div class="player-section">
    <div class="cover-image-container">
      <img *ngIf="album?.coverImage"
        [src]="album.coverImage"
        [alt]="(album.title || 'Unknown') + ' cover'"
        class="cover-image"
      />
      <div *ngIf="!album?.coverImage" class="placeholder-image">
        <mat-icon class="music-icon">album</mat-icon>
        <span class="placeholder-text">No Cover</span>
      </div>
    </div>

    <div class="player-controls">
      <div class="song-info">
        <h2 class="song-title">{{ album.title || 'Unknown Album' }}</h2>
        <p class="artist-names" *ngIf="album?.artists?.length">
          <span *ngFor="let artist of album.artists; let last = last">
            {{ artist?.name || 'Unknown Artist' }}<span *ngIf="!last">, </span>
          </span>
        </p>
      </div>

      <div class="detail-item" *ngIf="album?.genres?.length">
        <label>Genres:</label>
        <div class="genre-tags">
          <span *ngFor="let genre of album.genres" class="genre-tag">
            {{ genre }}
          </span>
        </div>
      </div>

      <div class="detail-item" *ngIf="album?.description">
        <label>Description:</label>
        <p class="description">{{ album.description }}</p>
      </div>

      <div class="detail-item" *ngIf="album?.releaseDate">
        <label>Release Date:</label>
        <span>{{ album.releaseDate | date }}</span>
      </div>
    </div>
  </div>

  <!-- Right Side - Songs Table -->
  <div class="details-section">
    <h1 class="details-title">Songs</h1>

    <audio #audioPlayer controls style="display:none"></audio>

    <table class="songs-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Duration</th>
          <th>Artists</th>
          <th>Genres</th>
          <th>Type</th>
          <th>Listen offline</th>
          <th>Download</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let song of album.songs" (click)="goToSongDetails(song.Id)">
            <td>{{ song.title }}</td>
            <td>{{ formatTime(song.duration || 0) }}</td>
            <td>
                <span *ngFor="let artist of song.artists; let last = last">
                    {{ artist?.name }}<span *ngIf="!last">, </span>
                </span>
            </td>
            <td>
                <span *ngFor="let genre of song.genres" class="genre-tag">
                    {{ genre }}
                </span>
            </td>
            <td>{{ song.type }}</td>
            <td>
                <button 
                    (click)="onOfflineButtonClick(song, audioPlayer); $event.stopPropagation()"
                    [disabled]="isProcessing"
                    [class.offline-saved]="isSongCached(song.Id)"
                    title="{{ isSongCached(song.Id) ? 'Play offline' : 'Save offline' }}"
                >
                    <i 
                        class="fas" 
                        [ngClass]="{
                            'fa-cloud-download-alt': !isSongCached(song.Id) && !isProcessing,
                            'fa-play-circle': isSongCached(song.Id) && !isProcessing,
                            'fa-spinner fa-spin': isProcessing 
                        }"
                    ></i>
                </button>

                <button
                    (click)="stopSong(); $event.stopPropagation()"
                    class="stop-btn"
                    title="Stop"
                >
                    <i class="fas fa-stop"></i>
                </button>
            </td>

            <td>
                <button
                    (click)="onDownloadClick(song.Id); $event.stopPropagation()"
                    [disabled]="isLoading"
                    class="download-btn"
                >
                    <ng-container *ngIf="!isLoading">
                        <i class="fas fa-download"></i> 
                    </ng-container>
                    <ng-container *ngIf="isLoading">
                        <i class="fas fa-spinner fa-spin"></i> 
                    </ng-container>
                </button>
            </td>
        </tr>      
      </tbody>
    </table>

    <ng-template #noSongs>
      <p>No songs found for this album.</p>
    </ng-template>
  </div>

</div>
